<!doctype html>
<html>
    <head>
        <title>My experiment</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src = "jsPsych-4.0.1/jspsych.js"></script>
		<script src = "jsPsych-4.0.1/plugins/jspsych-text.js"></script>
		<script src=  "jsPsych-4.0.1/plugins/jspsych-single-stim.js"></script>
		<script src=  "jsPsych-4.0.1/plugins/jspsych-html.js"></script>
		<script src = "javascript/stroop.js"></script>
		<script src = "javascript/decision_task.js"></script>
		<script src="javascript/mmturkey.js"></script>
		<link href = "jsPsych-4.0.1/css/jspsych.css" rel="stylesheet" type = "text/css"></link>
    </head>	
    <body >
    </body>
	
	<script>
	
	var decision_instructions = 
		'<div class="instructions">' +
  		'<div style="width: 600px; margin: 0 auto; text-align: center;' +
  		'background-color: #8C1516; padding: 20px 15px 10px 10px">' +
    	'<img src="images/stanford.png" height="46" width="360" alt="Stanford University"></div>' +
		'<p class="block-text">In this section, you will be required to make decisions in two ' +
		'stages to get money. ' + 
		'In each, two abstract shapes will come up on the screen on top of colored backgrounds. You choose one by ' +
		'pressing either "&larr;" or "&rarr;". Your choice in the first stage will bring you to one ' +
		'of two second-stages, each with two different abstract shapes and indicated by different ' +
		'color backgrounds. Each ' +
		'first-stage choice is primarily associated with one of the two second-stages. ' +
		'This means that each first-stage choice is more likely to bring you to one of the ' +
		'two second stages than the other. </p> '+
		'<p class="block-text">After moving to one of the two second-stages, ' +
		'you respond by again pressing an arrow key. ' +
		'After making this second choice you will get feedback ' +
		'(either a gold coin or a "0" indicating whether you won or lost on that trial.) ' +
		'These gold coins determine your bonus pay, so try to get as many as possible! </p>' +
		'<p class="block-text">There are four second-stage options - two stages with two shapes each. ' +
		'These four options each have a different likelihood of paying a gold coin. The chance ' +
		'of getting a coin from each of the second-stage shapes changes over the experiment ' +
		'so the best choice early on may not be the best choice later. ' +
		'In contrast, the chance of going to one of the second-stages after choosing a first-stage option stays ' +
		'fixed throughout the experiment.</p>' +
		'<p class="block-text"> We will begin with some practice, press <strong>"Enter"</strong> to start.</p></div>'
 
	
	var stroop_instructions = 
		'<div class="instructions"><div style="width: 500px; margin: 0 auto; text-align:' +  
		'center; background-color: #8C1516; padding: 20px 15px 10px 10px">' +
		'<img src="images/stanford.png" height="46" width="360" alt="Stanford University"></div>' + 
		'<p class="block-text">In this section, you will see color words appear one ' + 
		'at a time. The "ink" of the words also will be colored. For example, you may see: ' + 
		'<span class = "large" style = "color:blue">RED</span>, ' +  
		'<span class = "large" style = "color:blue">BLUE</span> or ' +  
		'<span class = "large" style = "color:red">BLUE</span>. Your task is to press ' + 
		'the button corresponding to the <strong> ink color </strong> of the word. There will ' + 
		'be two blocks of trials. The response keys are listed below: </p>' + 
		'<p><span class="large" style = "color:red">COLOR WORD</span>: Press the <strong>R</strong> key</p>' + 
		'<p><span class="large" style = "color:blue">COLOR WORD</span>: Press the <strong>B</strong> key</p>' + 
		'<p><span class="large" style = "color:green">COLOR WORD</span>: Press the <strong>G</strong> key</p>' +  
		'<p class = "block_text"> We will start with a few practice trials where you will get feedback. ' +
		'Instructions will remain on the screen during practice. To begin press <strong>"Enter"</strong>.	</p>'


	
	var stroop_text = {
		type: 'text',
		text: stroop_instructions,
		cont_key: 13
	}
	
	var decision_text = {
		type: 'text',
		text: decision_instructions,
		cont_key: 13
	}
	
	var inter_block = {
        type: 'text',
        text: "<div class='instructions'><p>Take a break! Press any key when you're ready to continue.</p></div>"
    }
    
    var stroop_begin_text= {
        type: 'text',
        text: "<div class='instructions'><p class='block-text'>We'll now start the first block " +
         "of trials. The instructions will no longer be displayed on the bottom of the " +
        "screen and you will no longer get feedback.</p><p>To begin press <strong>'Enter'</strong>.	</p></div>",
		cont_key: 13
    }
    
     var decision_begin_text= {
        type: 'text',
        text: "<div class='instructions'><p>We'll now start the real experiment.</p> " +
        	"<p>There will be two breaks 1/3 and 2/3 of the way through.</p>" +
        	"<p>To begin press <strong>'Enter'</strong>.</p></div>",
		cont_key: 13
    }
    
	var practice_stroop_chunk = {
		chunk_type: 'while',
		timeline: [fixation, practice_stroop_stim, practice_fb, intertrial_wait],
		continue_function: function() {
			if (practice_stims.stimulus.length == 0) { return false;}
			else { return true;}
		}
	}
	
	var freq_stroop_chunk = {
		chunk_type: 'while',
		timeline: [fixation, freq_stroop_stim, intertrial_wait],
		continue_function: function() {
			if (freq_shuffled_stims.stimulus.length == 0) { return false;}
			else { return true;}
		}
	}
	
	var infreq_stroop_chunk = {
		chunk_type: 'while',
		timeline: [fixation, infreq_stroop_stim, intertrial_wait],
		continue_function: function() {
			if (infreq_shuffled_stims.stimulus.length == 0) { return false;}
			else { return true;}
		}
	}
	
	var decision_practice = {
		chunk_type: 'while',
		timeline: [first_stage_chunk, second_stage,
					FB_chunk, noFB_chunk],
		continue_function: function() {
			if (fs_stim_shuffled.stimulus.length == 0) {change_stims(); return false;}
			else {return true;}
		}
	}
	
	var decision_chunk1 = {
		chunk_type: 'while',
		timeline: [first_stage_chunk, second_stage,
					FB_chunk, noFB_chunk],
		continue_function: function() {
			if (fs_stim_shuffled.stimulus.length <= Math.round(fs_stim_shuffled.id.length*2/3)) { return false;}
			else {return true;}
		}
	}
	
	var decision_chunk2 = {
		chunk_type: 'while',
		timeline: [first_stage_chunk, second_stage,
					FB_chunk, noFB_chunk],
		continue_function: function() {
			if (fs_stim_shuffled.stimulus.length <= Math.round(fs_stim_shuffled.id.length/3)) { return false;}
			else {return true;}
		}
	}
	
	var decision_chunk3 = {
		chunk_type: 'while',
		timeline: [first_stage_chunk, second_stage,
					FB_chunk, noFB_chunk],
		continue_function: function() {
			if (fs_stim_shuffled.stimulus.length == 0) { return false;}
			else {return true;}
		}
	}
	
	var submit = {
		type: 'text',
		text: "<p>Thanks for participating! You're finished! The HIT will automatically submit.</p>",
		on_finish: function() {
			opener.turk.submit(jsPsych.data.getData())
			}
	}
	
	var decision_before = Math.round(Math.random())
	var experiment = [];
	decision_before = 1
		
	if (decision_before == 1) {	
		experiment.push(decision_text)
		experiment.push(decision_globaldata);
		experiment.push(decision_practice);
		experiment.push(decision_begin_text);
		experiment.push(decision_globaldata);
		experiment.push(decision_chunk1);
		experiment.push(inter_block);
		experiment.push(decision_chunk2);
		experiment.push(inter_block);
		experiment.push(decision_chunk3);
	}
	
	experiment.push(stroop_text)
	experiment.push(practice_stroop_chunk)
	experiment.push(stroop_begin_text)
	if (Math.random() < .5) {
		experiment.push(freq_stroop_chunk);
		experiment.push(inter_block);
		experiment.push(infreq_stroop_chunk);
	} else {
		experiment.push(infreq_stroop_chunk);
		experiment.push(inter_block);
		experiment.push(freq_stroop_chunk);
	}
	if (decision_before == 0) {
		experiment.push(decision_text)
		experiment.push(decision_practice);
		experiment.push(decision_begin_text);
		experiment.push(decision_chunk1);
		experiment.push(inter_block);
		experiment.push(decision_chunk2);
		experiment.push(inter_block);
		experiment.push(decision_chunk3);
	}
	experiment.push(submit);
	
	jsPsych.preloadImages([experiment_stims, practice_dstims], function() {startExperiment();});
	function startExperiment(){
		jsPsych.init({
			experiment_structure: experiment,
			show_progress_bar: true
		});
	}
	
	
	</script>
</html>